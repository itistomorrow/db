<?
include "includes/DBaccess.php";
include "includes/session.php";

?>

<!DOCTYPE html>
<html lang="kr">
	<head>
		<meta charset="euc-kr">

		<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
		Remove this if you use the .htaccess -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

		<title></title>
		<meta name="description" content="">
		<meta name="author" content="DaHam">

		<meta name="viewport" content="width=device-width; initial-scale=1.0">

		<!-- Bootstrap -->
		<link href="css/bootstrap.min.css" rel="stylesheet">

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->

		<script language="JavaScript">
			var color = "#FFFF7E";

			function addRow(var1, var2, var3, var4, var5, var6, var7, var8, var9) {
				var tbody = document.getElementById("score_table").getElementsByTagName("TBODY")[0];
				var row = document.createElement("TR");
				row.style.backgroundColor = color;

				var td1 = document.createElement("TD");
				body1 = "<p align='center'>" + var1 + "</p>";
				td1.insertAdjacentHTML('beforeEnd', body1);

				var td2 = document.createElement("TD");
				body2 = "<p align='center'>" + var2 + "</p>";
				td2.insertAdjacentHTML('beforeEnd', body2);

				var td3 = document.createElement("TD");
				body3 = "<p align='center'>" + var3 + "</p>";
				td3.insertAdjacentHTML('beforeEnd', body3);

				var td4 = document.createElement("TD");
				body4 = "<p align='center'>" + var4 + "</p>";
				td4.insertAdjacentHTML('beforeEnd', body4);

				var td5 = document.createElement("TD");
				body5 = "<p align='center'>" + var5 + "</p>";
				td5.insertAdjacentHTML('beforeEnd', body5);

				var td6 = document.createElement("TD");
				body6 = "<p align='center'>" + var6 + "</p>";
				td6.insertAdjacentHTML('beforeEnd', body6);

				var td7 = document.createElement("TD");
				body7 = "<p align='center'>" + var7 + "</p>";
				td7.insertAdjacentHTML('beforeEnd', body7);

				var td8 = document.createElement("TD");
				body8 = "<p align='center'>" + var8 + "</p>";
				td8.insertAdjacentHTML('beforeEnd', body8);

				var td9 = document.createElement("TD");
				body9 = "<p align='center'>" + var9 + "</p>";
				td9.insertAdjacentHTML('beforeEnd', body9);

				row.appendChild(td1);
				row.appendChild(td2);
				row.appendChild(td3);
				row.appendChild(td4);
				row.appendChild(td5);
				row.appendChild(td6);
				row.appendChild(td7);
				row.appendChild(td8);
				row.appendChild(td9);
				tbody.appendChild(row);
			}

		</script>

	</head>

	<body>
		<div>
			<header>

			</header>
			<nav>

			</nav>

			<div>
				<table id ="score_table" border="0" width="800" height="70" align="center">
					<tbody>
						<tr>
							<td width="130" height="50" bgcolor="#B4FFFF" >
							<p align="center">
								<b>과목이름</b>
							</p></td>
							<td width="80" height="50" bgcolor="#B4FFFF" ">
							<p align="center"><b>과목번호</b></p>
							</td>
							<td width="50" height="50" bgcolor="#B4FFFF" >
							<p align="center"><b>분반</b></p>
							</td>
							<td width="50" height="50" bgcolor="#B4FFFF">
							<p align="center"><b>학년</b></p>

							</td>

							<td width="108" height="50" bgcolor="#B4FFFF">
							<p align="center"><b>교과구분</b></p>
							</td>
							<td width="69" height="50" bgcolor="#B4FFFF">
							<p align="center"><b>과제점수</b></p>
							</td>
							<td width="69" height="50" bgcolor="#B4FFFF">
							<p align="center"><b>중간고사</b></p>
							</td>
							<td width="69" height="50" bgcolor="#B4FFFF">
							<p align="center"><b>기말고사</b></p>
							</td>
							<td width="74" height="50" bgcolor="#B4FFFF">
							<p align="center"><b>성 적</b></p>
							</td>
							</tr>
							</tbody>
							</table>
							<?

							$query = "SELECT 학생_성적.과목번호, 과목이름, 과목구분, 학생_성적.과목분반, 학생_성적.수강학년, 학생_성적.과제점수, 학생_성적.중간점수, 학생_성적.기말점수, 학생_성적.학점
							FROM 과목, (SELECT 과목번호, 과목분반, 수강학년, 과제점수, 중간점수, 기말점수, 학점
							FROM 수강
							WHERE 구성원번호='$_SESSION[ss_id]'
							AND 학점 IS NOT NULL) 학생_성적
							WHERE 과목.과목번호=학생_성적.과목번호";

							$data = oci_parse($connect,$query);
							oci_execute($data);

							$count = 0;
							$point = 0;

							while($stu_score = oci_fetch_array($data)) {
							if($stu_score[학점] == "A+") $tmp = 4.5;
							else if($stu_score[학점] == "A") $tmp = 4.0;
							else if($stu_score[학점] == "B+") $tmp = 3.5;
							else if($stu_score[학점] == "B") $tmp = 3.0;
							else if($stu_score[학점] == "C+") $tmp = 2.5;
							else if($stu_score[학점] == "C") $tmp = 2.0;
							else if($stu_score[학점] == "D+") $tmp = 1.5;
							else if($stu_score[학점] == "D") $tmp = 1.0;
							else if($stu_score[학점] == "F") $tmp = 0;

							$point = $point + $tmp;
							++$count;

							echo "<script language=javascript>
							addRow(\"$stu_score[과목이름]\", \"$stu_score[과목번호]\", \"$stu_score[과목분반]\",
							\"$stu_score[수강학년]\", \"$stu_score[과목구분]\",\"$stu_score[과제점수]\",
							\"$stu_score[중간점수]\", \"$stu_score[기말점수]\", \"$stu_score[학점]\"); </script>";
							}

							?>
							<table border="0" width="200" align = "center">
								<tr>
									<td width="80">
									<p align="right">
										총 평균평점 :
									</p></td>
									<td width="20">
									<p align="left">
										<? if($point != 0 ) printf("%0.2f",$point/$count);
										else echo 0; ?>
									</p></td>
									<td width="30">
									<p align="left">
										/ 4.5
									</p></td>
								</tr>
							</table>
			</div>

			<footer>

			</footer>
		</div>

		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<!-- Include all compiled plugins (below), or include individual files as needed -->
		<script src="js/bootstrap.min.js"></script>
	</body>
</html>